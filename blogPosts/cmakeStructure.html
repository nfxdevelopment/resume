<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Nicholas Winder</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/main.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,400i,500,700,900" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div id="loader"></div>
  <div id="main" style="visibility:hidden">
    <div class="col-3 header-badge">
        <img src="../img/profilePictureWithBackground.png">
        <input id="resume-button" class="portfolio-input" name="navigation-buttons" type="radio" checked>
        <label id="resume-holder" class="navigation-item" for="resume-button">
            <svg class="navigation-icon-image" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                 viewBox="0 0 24 24">
                <path id="resume-icon" class="navigation-icon-svg"
                      d="M2 3H22C23.1 3 24 4 24 5V19C24 20.1 23.1 21 22 21H2C1 21 0 20.1 0 19V5C0 4 1 3 2 3M14 6V7H22V6H14M14 8V9H21.5L22 9V8H14M14 10V11H21V10H14M8 13.9C6 13.9 2 15 2 17V18H14V17C14 15 10 13.9 8 13.9M8 6A3 3 0 0 0 5 9 3 3 0 0 0 8 12 3 3 0 0 0 11 9 3 3 0 0 0 8 6Z"></path>
            </svg>
            RESUME
        </label>

        <input class="portfolio-input" name="navigation-buttons" type="radio" id="portfolio-button"/>
        <label id="portfolio-holder" class="navigation-item" for="portfolio-button">
            <svg class="navigation-icon-image" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                 viewBox="0 0 24 24">
                <path id="portfolio-icon" class="navigation-icon-svg"
                      d="M13 9H18.5L13 3.5V9M6 2H14L20 8V20A2 2 0 0 1 18 22H6C4.9 22 4 21.1 4 20V4C4 2.9 4.9 2 6 2M6 20H15L18 20V12L14 16 12 14 6 20M8 9A2 2 0 0 0 6 11 2 2 0 0 0 8 13 2 2 0 0 0 10 11 2 2 0 0 0 8 9Z"></path>
            </svg>
            PORTFOLIO
        </label>

        <div class="social">
            <div class="social-links">
                <div>
                    <a id="github-link" href="https://github.com/nfxdevelopment">
                        <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 60 60" width="32">
                            <g id="github-icon-svg" class="social-icon-svg">
                                <path
                                    d="M3 0L57 0C58.7 0 60 1.3 60 3L60 57C60 58.7 58.7 60 57 60L3 60C1.3 60 0 58.7 0 57L0 3C0 1.3 1.3 0 3 0Z"></path>
                            </g>
                            <g class="social-icon-svg-innner">
                                <path
                                    d="M25.4 47.5C25.4 47.1 25.4 45.9 25.4 44.3 20.3 45.4 19.2 41.8 19.2 41.8 18.3 39.6 17.1 39 17.1 39 15.5 37.8 17.3 37.8 17.3 37.8 19.1 38 20.1 39.8 20.1 39.8 21.7 42.7 24.4 41.8 25.5 41.4 25.6 40.1 26.1 39.3 26.6 38.8 22.5 38.4 18.2 36.7 18.2 29.5 18.2 27.4 18.9 25.7 20.1 24.4 19.9 23.9 19.3 22 20.3 19.4 20.3 19.4 21.9 18.9 25.4 21.3 26.9 20.9 28.4 20.7 30 20.7 31.6 20.7 33.1 20.9 34.6 21.3 38.1 18.9 39.7 19.4 39.7 19.4 40.7 22 40.1 23.9 39.9 24.4 41.1 25.7 41.8 27.4 41.8 29.5 41.8 36.7 37.5 38.3 33.3 38.8 34 39.4 34.6 40.6 34.6 42.3 34.6 44.9 34.6 46.9 34.6 47.5 34.6 48 34.9 48.6 35.8 48.4 43.2 45.9 48.5 38.8 48.5 30.5 48.5 20 40.2 11.5 30 11.5 19.8 11.5 11.5 20 11.5 30.5 11.5 38.8 16.8 45.9 24.2 48.4 25.1 48.6 25.4 48 25.4 47.5Z"></path>
                            </g>
                        </svg>
                    </a>
                    <a id="linkedin-link" href="https://www.linkedin.com/in/nicholas-winder-57a6a292/">
                        <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 60 60" width="32">
                            <g id="linkedin-icon-svg" class="social-icon-svg">
                                <path
                                    d="M3 0L57 0C58.7 0 60 1.3 60 3L60 57C60 58.7 58.7 60 57 60L3 60C1.3 60 0 58.7 0 57L0 3C0 1.3 1.3 0 3 0Z"></path>
                            </g>
                            <g class="social-icon-svg-innner">
                                <path
                                    d="M21.9 43.8L21.9 25.5 16.2 25.5 16.2 43.8 21.9 43.8ZM21.9 19C21.8 17.4 20.8 16.2 19 16.2 17.2 16.2 16.1 17.4 16.1 19 16.1 20.6 17.2 21.9 18.9 21.9L19 21.9C20.8 21.9 21.9 20.6 21.9 19ZM31.1 43.8L31.1 33.4C31.1 32.8 31.2 32.3 31.3 31.9 31.8 30.8 32.8 29.6 34.5 29.6 36.7 29.6 38.2 30.9 38.2 33.4L38.2 43.8 43.8 43.8 43.8 33.1C43.8 27.4 40.8 24.7 36.7 24.7 33.4 24.7 31.9 26.6 31.1 27.9L31.1 25.4 25.4 25.4C25.5 27.2 25.4 43.8 25.4 43.8L31.1 43.8Z"></path>
                            </g>
                        </svg>
                    </a>
                </div>
                <a class="social-link" href="mailto:nicholastwinder@gmail.com?Subject=Personal%20Website%20-%20"
                   target="_top">
                    <h5>nicholastwinder@gmail.com</h5>
                </a>
            </div>
        </div>
    </div>
    <div class="col-9 main-content">
      <div class="dynamic-content blog">
            <div id="blog-content" class="content">
<div class="content-card"><h1 id="cmake---regain-a-bit-of-structure-in-your-life">CMake - Regain a bit of structure in your life</h1></div><div class="content-card"><h2 id="intro">Intro</h2>
<p>CMake is used in many places when building cross platform C++ projects. For me now, it is the defacto &quot;goto&quot; language to describe my build system. This isn't to say it doesn't have pitfalls, especially when information online is outdated and not agreed upon in the community. But I believe there are better ways to achieve cleaner cmake files.</p>
<p>Normally I would say, your first port of call is the man pages/README/project tutorial hosted on the web. CMake is an exception to this rule as a lot of information found in the <a href="https://cmake.org/cmake-tutorial/">CMake tutorial</a> is outdated. It will still work in most instances, but much like &quot;modern c++&quot;, there is a concept of &quot;modern CMake&quot;, which will help you in the long run. When searching for information for a solution, I often append the word &quot;modern&quot; to search term, while also limiting the search results to the past few years. (If you are looking for a intro to CMake please watch this <a href="https://www.youtube.com/watch?v=JsjI5xr1jxM">video</a>.)</p>
</div><div class="content-card"><h2 id="structure">Structure</h2>
<p>One very important factor to any project is structure. Obviously there are many arguments around project structure (where do includes go? single folder for all source?), but lets not get into these ones. CMake also benefits from having some structure to the CMake files. This is because many methods will allow sub-cmake files to inherit from their definitions, which can cause a lot of unknown and unwanted behaviour if unaware of this.</p>
<h4 id="structure-done-right">Structure done right</h4>
<p>One great example of this is the addition of definitions to compiler flags. Let's use the following example.</p>
<pre><code>...
    add_definitions(-DPRINT_SECURE_INFOMATION)
    add_executable(my_test_app source.cpp)

    add_subdirectory(my_lib)
    target_link_libraries(my_test_app my_lib)
...</code></pre>
<p>Here we can see that <code>PRINT_SECURE_INFOMATION</code> is defined for <code>my_test_app</code> , this may print some key information in your test app that should never be released to the public. We also add a sub-directory that we can expect to compile <code>my_lib</code>, we then link against this in <code>my_test_app</code>. A lot of people would not expect <code>PRINT_SECURE_INFOMATION</code> to be defined in the compilation of <code>my_lib</code>, but this is not true. As <code>add_subdirectory</code> is called after <code>add_definitions(-DPRINT_SECURE_INFOMATION)</code> it will be inherited by any compilation defined in <code>my_lib</code> directory. This could have huge consequences for a release version of <code>my_lib</code>, causing issues you could only imagine. But the key here is how to get round this. There are actually two ways of mitigating this issue and the first is the structure.</p>
<p>If we employed a better structure, we would never had this issue. The ideal folder structure is as below</p>
<h5 id="folder-structure">Folder structure</h5>
<pre><code>source/
    CMakeLists.txt
    my_test_app/
        CMakeLists.txt
        source.cpp
        source.hpp
    my_lib/
        CMakelists.txt
        source.cpp
        source.hpp</code></pre>
<h5 id="sourcecmakelists.txt">source/CMakelists.txt</h5>
<pre><code>...
    add_subdirectory(my_test_app)
    add_subdirectory(my_lib)
...</code></pre>
<h5 id="sourcemy_test_appcmakelists.txt">source/my_test_app/CMakelists.txt</h5>
<pre><code>...
    add_definitions(-DPRINT_SECURE_INFOMATION)
    add_executable(my_test_app source.cpp)

    target_link_libraries(my_test_app my_lib)
...</code></pre>
<p>Now we can see that the definition can be placed in the cmake file only handling the compilation of <code>my_test_app</code>. This is great as we do not get leaking definitions.</p>
<p>This is not only true for definitions, it's true of <code>include_directories</code>, which can also cause <a href="https://stackoverflow.com/questions/19981534/cmake-include-directories">hard to diagnose issues</a>, and also in lots of other places, but there are other ways to get round this.</p>
<h4 id="target-who">Target who?</h4>
<p>Some of us do not have the luxury of defining our folder structure. If we are retro fitting CMake to an existing project, or maybe the team is insistent on using a difference structure (for a valid reason), we have another option. <code>target*</code>methods.</p>
<p>In addition to <code>target_link_libraries</code>, the concept of more <code>target*</code> methods came about in CMake 2.8.12, and this is when the true <strong>modern</strong> CMake started. This is a way of specifying which target you want the given operation to be applied to. Therefore we can always ensure that the operations will not be leaked to other directories or targets. Here's a list of the methods.</p>
<pre><code>target_compile_options
target_compile_definitions
target_include_directories
target_sources  </code></pre>
<p>We can probably guess what most of these do, but just look them up in the <a href="https://cmake.org/cmake/help/v3.10/index.html">documentation</a> if you are unsure.</p>
<p>Not that it's a good idea, but theoretically you can have all your libraries and executable additions in one CMake file and there will be no leakage issues. THis is great for when you can not guarantee structure. This also helps with portability when needing to move folders with accompanying CMake files.</p>
</div><div class="content-card"><h2 id="structure-round-up">Structure Round Up</h2>
<p>Applying the fixes explained above are both important ways to help other users read and maintain CMake in your project. Although the structure of the project and CMake files have become less important in recent years due to <code>target*</code> usage, it does allow the user to follow the flow of the project and build up a mental model to work from.</p>
<p>I recommend you immediately start using <code>target*</code> methods in current and future projects. The benefits are not only found in structuring, but also scoping, which will be discussed in future post. There is no reason to see <code>include_directories</code> any more, however you could have some arguments for using <code>add_definitions</code> for wide casting architecture needs.</p>
</div>
            </div>
      </div>
    </div>
</div>

<script src="../js/blog.js"></script>

<!-- Google Analytics -->
<script>
    (function (b, o, i, l, e, r) {
        b.GoogleAnalyticsObject = l;
        b[l] || (b[l] =
            function () {
                (b[l].q = b[l].q || []).push(arguments)
            });
        b[l].l = +new Date;
        e = o.createElement(i);
        r = o.getElementsByTagName(i)[0];
        e.src = 'https://www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e, r)
    }(window, document, 'script', 'ga'));
    ga('create', 'UA-104171564-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>
